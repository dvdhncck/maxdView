<HTML>
<HEAD>
<TITLE>Super Grouper</TITLE>
</HEAD>
<BODY>
<!-- PAGE BREAK -->

<H2>Super Grouper</H2>

<P>The <I>Super Grouper</I> organises Spots into groups based on
their similarity of their expression profiles. Hierarchical clustering
can then be applied within the groups. </P>
 
<UL>
<LI><A HREF="#overview">Overview</A>
<LI><A HREF="#interface">User interface</A>
<LI><A HREF="#adjust">Auto-adjust</A>
<LI><A HREF="#spots">Identifying Spots</A>
<LI><A HREF="#cluster">Make clusters</A>
<LI><A HREF="#example">Examples</A>
</UL>

<P>&nbsp</P>


<H3><A NAME="overview">Overview</a></H3>

<P>The basic idea of the <I>Super Grouper</I> is to partition spots
into groups whereby all Spots in one group have similar expression
profiles.</P>

<P>Each group has a "target profile". The expression profile of each
 Spot is checked against all of the target profiles, and the Spot is
 put into the group with the most similar target profile.</P>

<P>The target profiles can be adjusted by hand, or the "Auto adjust"
can be used feature to iteraratively tweak the profiles.</P>

<P>&nbsp</P>

<H3><A NAME="interface">User interface</a></H3>

<P>The main controls for the <I>Super Grouper</I> are in the panel on
the left-hand side of the window.</P>
 
<P>The top portion of this panel contains a list of
Measurements. Select two or more Measurements for inclusion in the
profile.</P>

<P>The bottom portion of this panel is divided into four
sections:</P>

<P><UL>
<LI><A HREF="#metric">Similarity Metric</A>
<LI><A HREF="#groups">Groups</A>
<LI><A HREF="#options">Options</A>
<LI><A HREF="#adjust">Auto-adjust</A>
</UL></P>


<P><HR WIDTH=33%></P>

<A NAME="metric"><H3>Similarity Metric</H3></A>

<P>The similarity metric is the calculation that is used to quantify
the similarity between two profiles. Three different metrics are
supported in this plugin:</P>

<P><TABLE WIDTH=95%> 
<TR><TD ALIGN=RIGHT>Distance:&nbsp;</TD><TD><I>the sum of the squared differences between values</I></TD></TR>
<TR><TD ALIGN=RIGHT>Slope:&nbsp;</TD><TD><I>the sum of the differences between the first derivatives of the values</I></TD></TR>
<TR><TD ALIGN=RIGHT>Direction:&nbsp;</TD><TD><I>a score generated by comparing direction changes</I></TD></TR>
</TABLE></P>

<P>The three metrics are illustrated in the following example in which
there are 4 spots (A,B,C and D) with values in 3 Measurements (1,2 and
3):</P>

<CENTER>
<TABLE>
<TR>
<TD ALIGN=RIGHT VALIGN=MIDDLE>
<TABLE BORDER=1>
<TR>
<TD></TD><TD ALIGN=CENTER><B>Meas 1</B></TD><TD ALIGN=CENTER><B>Meas 2</B></TD><TD ALIGN=CENTER><B>Meas 3</B></TD></TR>
<TD><FONT COLOR="#3333ff"><B>Spot A</B></FONT></TD><TD ALIGN=RIGHT>0.75</TD><TD ALIGN=RIGHT>0.0</TD><TD ALIGN=RIGHT>0.1</TD></TR>
<TD><FONT COLOR="#ff0033"><B>Spot B</B></FONT></TD><TD ALIGN=RIGHT>0.65</TD><TD ALIGN=RIGHT>0.1</TD><TD ALIGN=RIGHT>-0.05</TD></TR>
<TD><FONT COLOR="#66ff99"><B>Spot C</B></FONT></TD><TD ALIGN=RIGHT>0.05</TD><TD ALIGN=RIGHT>-0.6</TD><TD ALIGN=RIGHT>-0.7</TD></TR>
<TD><FONT COLOR="#ff9933"><B>Spot D</B></FONT></TD><TD ALIGN=RIGHT>-0.1</TD><TD ALIGN=RIGHT>-0.8</TD><TD ALIGN=RIGHT>-0.4</TD></TR>
</TABLE></TD>
<TD ALIGN=LEFT><IMG SRC="Profiles.jpg"></CENTER></TD>
</TR>
</TABLE>
</CENTER>

<P>Using the <B>Distance</B> metric, spots A and B are most
similar. This is because the sum of of the absolute differences
between corresponding pairs of values is smallest for these two
profiles.</P>

<P>Formally: 

<PRE>
    distance_metric(A, B) = abs(A1 - B1) + abs(A2 - B2) + abs(A3 - B3)
    distance_metric(A, C) = abs(A1 - C1) + abs(A2 - C2) + abs(A3 - C3)
    .....
</PRE>

where <TT>abs()</TT> is the <I>absolute</I> function: <TT>abs(-X) = X</TT></P>

<P>With the <B>Slope</B> metric, spots A and C are most similar. This
metric calculates the sum of the differences of the first derivatives
of the values, i.e. the slopes of the two line segments (the one
joining Measurements 1 and 2 and the other one joining Measurements 2
and 3). The profile with the smallest sum is regarded as the most
similar.</P>

<P>Formally: 

<PRE>
    slope_metric(A, B) = abs( (A2-A1) - (B2-B1) ) + abs( (A3-A2) - (B3-B3) )
    slope_metric(A, C) = abs( (A2-A1) - (C2-C1) ) + abs( (A3-A2) - (C3-C3) )
    .....
</PRE>

<P>This metric therefore chooses lines which have similar (but not
neccessarily identical) behaviours in terms of the changes between
Measurements</P>


<P>The final metric, <B>Direction</B> compares only the direction of
the slopes of the lines joining the Measurements. A 'score' is
generated by comparing each pair of line segments, if they go in
different directions then 1 is added to the score. The most similar
profile is the ones with the lowest score. In the above example, spots
A and D are the most similar because they both go "down, up" (spots C
and B both go "down,down").</P>


<P><HR WIDTH=33%></P>

<A NAME="groups"><H3>Groups</H3></A>

<P>Groups are collections of Spots which have similar profiles. Each
group has a 'candidate profile'. Spots are allocated to groups by
comparing their profiles with each of the candidate profiles (using
the similarity metric) and then choosing the candidate which is most
similar.</P>

<P>The buttons in the Groups palette are used to control how many
groups are required and to provide initial candidate profiles for
these groups.</P>

<P>A specific number of groups can be requested using the type-in
field. Enter a number and press "<B>Set</B>" to initialise the
groups. Any number of groups can be used, although very large numbers
will be time and memory consuming.</P>

<P>The "<B>Use Spot selection</B>" button initialises the groups using
the currently selected Spots. Each Spot in the selection will become
the candidate profile for a group. This is useful if you have
previously identified some candiate profiles.</P>

<P>The "<B>Permutations</B>" button initialises the groups so that all
possible permutations of the basic profile shapes are represented. If
for example, there are 3 Measurments selected then there are 8 (3 to
the power of 3) possible permutations of the profile, namely:
"up,up,up", "up,up,flat", "up,up,down", "up,flat,up", "up,flat,flat"
and so on. </P>

<P>The "<B>Randomise</B>" button randomly allocates new candicate
profiles to each of the current groups.</P>

<P>The "<B>Remove Empty</B>" button deletes any groups which currently
have no Spot profiles assigned to them.</P>



<P><HR WIDTH=33%></P>

<A NAME="options"><H3>Options</H3></A>

<P>The "<B>Apply filter</B>" option controls whether any currently
enabled <A HREF="../../../docs/Filters.html">Filters</B> are used to
restrict the number of Spots that will be grouped.</P>

<P>The "<B>Edit profiles</B>" option enables interactive editing of
the candidate profiles. When this option is active the mouse can be
used to drag the individual points on the candidate profiles up and
down the axis. After each adjustment, the Spots will be automatically
regrouped.</P>

<P><HR WIDTH=33%></P>


<A NAME="adjust"><H3>Auto-adjust</H3></A>

<P>Auto-adjust mode is an interative process in which the candiate
profiles are repeatedly altered and the Spots re-allocated to
groups. A variety of different rules can be employed to control how
the profiles are adjusted.</P>

<P>The "<B>Enable</B>" switch turns auto-adjust mode on and off. When
it is on, a count of how many iterations have been done is displayed
next to the switch. Note that in order to improve performance, the
display is only updated every two seconds, not every interation.</P>

<P>Two drop-down menus control the main aspects of auto-adjust mode:</P>

<P>1. Which group(s) to adjust:
<TABLE WIDTH=95%>
<TR><TD ALIGN=RIGHT>Smallest:&nbsp;</TD><TD><I>adjust the group with the fewest Spots</I></TD></TR>
<TR><TD ALIGN=RIGHT>Biggest:&nbsp;</TD><TD><I>adjust the group with the most Spots</I></TD></TR>
<TR><TD ALIGN=RIGHT>Best:&nbsp;</TD><TD><I>adjust the group with the best fit (the least difference between profiles)</I></TD></TR>
<TR><TD ALIGN=RIGHT>Worst:&nbsp;</TD><TD><I>adjust the group with the worst fit (the biggest difference between profiles)</I></TD></TR>
<TR><TD ALIGN=RIGHT>Random:&nbsp;</TD><TD><I>adjust a randomly chosen group</I></TD></TR>
<TR><TD ALIGN=RIGHT>All:&nbsp;</TD><TD><I>adjust all groups</I></TD></TR>
</TD></TR></TABLE>
</P>

<P>2. How the profile(s) in the chosen groups(s) are altered:
<TABLE WIDTH=95%>
<TR><TD ALIGN=RIGHT>Mean:&nbsp;</TD><TD><I>adjust the candidate profile towards the mean profiles for all spots in the group</I></TD></TR>
<TR><TD ALIGN=RIGHT>Mean Spot:&nbsp;</TD><TD><I>adjust the candidate profile towards the that of the most average spot in the group </I></TD></TR>
<TR><TD ALIGN=RIGHT>Random:&nbsp;</TD><TD><I>randomly adjust the candidate profile</I></TD></TR>
</TD></TR></TABLE>
</P>

<P>The "<B>Rate</B>" slider controls  the amount by which the candiate
profiles are adjusted. Bigger values lead to greater alteration of the
profiles.</P>

<P>The "<B>Noise</B>" slider allows an amount of random noise to be
introduced into the candiate profile of the group(s) chosen for
adjustment. Adding noise can be useful as it prevents the allocation
of spots to groups from becoming 'stuck' in one particular
configuration.</P>

<P>When "<B>Auto remove empty</B>" option is selected then groups
which become empty during the optimisation are discarded.</P>


<P><HR WIDTH=33%></P>

<A NAME="spots"><H3>Identifying Spots</H3></A>

<P>When the mouse pointer is rested over a Spot profile for a moment, a
tool-tip window appears containing an identification label. This label
can be any of the <A HREF="../../../docs/Concepts.html#spot">Name or
Name Attributes</A> in the current data. The choice of which Name or
Name Attribute to show is made via the drop-down menu in the control
bar along the top of the window.</P>

<P>Click on a profile to add a name label to the plot. Click on the
profile again to remove the label. The "<B>Clear all</B>" button
removes all name labels that have been added to the plot. The
"<B>Label selection</B>" button adds labels to all Spot profiles which
are currently in the <A
HREF="../../../docs/Concepts.html#sel">Spot selection</A>.</P>

<P>The size of the label font can be adjusted using the "<B>a+</B>"
and "<B>a-</B>" buttons.</P>

<P><A HREF="../../../docs/Concepts.html#drag">Drag-and-drop</A> can be
used to locate particular Spots in the plot. Drag one or more Spots
from the main display and drop them into the <I>HyperCube Plot</I>
window. This causes the name(s) to appear next to the profiles on the
plot. Dropping a Cluster onto the panel causes the names of all Spots
in the cluster to be displayed.</P>

<P>The "<B>AutoSpace</B>" option attempts to improve the readability
of the graphs by reducing the quantity of displayed labels. When this
mode is enabled, labels will only be drawn if there is enough space
for them. Note that when there is not a lot of space, or a lot of
labels, this mode can lead to some spot labels not being displayed.</P>
 
<P>Spots which have been selected for labelling can also be displayed
in colour to make them more visible. The "<B>Colour</B>" checkbox controls
this feature.</P>

<P><HR WIDTH=33%></P>

<A NAME="clusters"><H3>Make clusters</H3></a>

<P>The groups can be converted into <A HREF="../../../docs/Concepts.html#clust">clusters</A> using one of
three methods:</P>

<P>
<DL>
<P><DT>One cluster per group
<DD><I>Generates 'flat' clusters, requires little time or memory</I></P>

<P><DT>Hierarchical, most accurate
<DD><I>Proper clustering (see below),
can take a long time</I></P> 

<P><DT>Hierarchical,quickest
<DD><I>Quick-and-dirty clustering, run quickly but uses a lot more memory than
the proper mode</I></P>

<P><DT>Hierarchical,experimental
<DD><I>Nearly proper clustering (see below), but using a heuristic to
compute approximate tnearest neighbours. Runs quickly and doesn't
require too much memory, but might not generate reproducable results.</I></P>

</DL>
</P>

<P>&nbsp</P>

<P>The 'proper' hierarchical clustering algorithm operates by
repeatedly finding the two profiles which are closest to one another
and then joining them together. The two joined profiles are removed
from the group and replaced by their average. This process is repeated
until there are no profiles left to join.</P>

<P>As an example, the following images show how the algorithm would
proceed in a simple 2D case:</P>

<P>
<P><TABLE>
<TR>
<TD>Initial state</TD>
<TD>Join 1 &amp; 6 to make A</TD>
<TD>Join 4 &amp; 7 to make B</TD>
</TR>
<TR>
<TD><IMG SRC="example1.jpg"></TD>
<TD><IMG SRC="example2.jpg"></TD>
<TD><IMG SRC="example3.jpg"></TD>
</TR>
<TR>
<TD>Join A &amp; 2 to make D</TD>
<TD>Join B &amp; 5 to make E</TD>
<TD>Join D &amp; 3 to make F</TD>
</TR>
<TR>
<TD><IMG SRC="example4.jpg"></TD>
<TD><IMG SRC="example5.jpg"></TD>
<TD><IMG SRC="example6.jpg"></TD>
</TR>
<TR>
<TD>Join E &amp; F, finished</TD>
<TD>Resulting cluster tree</TD>
</TR>
<TR>
<TD><IMG SRC="example7.jpg"></TD>
<TD><IMG SRC="example-tree.jpg"></TD>
</TR>
</TABLE>

<P><HR WIDTH=33%></P>

<A NAME="example"><H3>Examples</H3></a>

<P>There are a lot of parameters in the <I>Super Grouper</I>, the best
way to find out how they interact is by experimentation.</P>

<P>.....</P>

<P><HR></P>

</BODY>
</HTML>